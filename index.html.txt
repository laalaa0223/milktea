<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026æ‰‹æ–å¤§ä½œæˆ° â™¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&family=Varela+Round&family=Noto+Sans+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --aqua-main: #78C2C4;
            --aqua-soft: #E0F7F6;
            --orange-main: #FFB380;
            --orange-soft: #FFF2E6;
        }

        body {
            font-family: 'Varela Round', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--aqua-soft) 0%, var(--orange-soft) 100%);
            height: 100vh;
            margin: 0;
            overflow: hidden; /* ç¦æ­¢æ•´é æ²å‹•ï¼Œé”æˆå…¨å±é–å®š */
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
        }

        .bg-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            bottom: -50px;
            opacity: 0.1;
            animation: float-up 10s infinite linear;
        }

        @keyframes float-up {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        .cute-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            color: white;
            text-shadow: 2px 2px 0px var(--aqua-main);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 25px;
            border: 4px solid white;
            box-shadow: 0 10px 30px rgba(120, 194, 196, 0.1);
            backdrop-filter: blur(8px);
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 4px;
            border: 1px solid white;
            text-align: center;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            background: white;
            border: 1px solid #F6F6F6;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day.active {
            background: var(--orange-soft);
            border-color: var(--orange-main);
            box-shadow: inset 0 0 5px rgba(255, 179, 128, 0.2);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            z-index: 100;
            justify-content: center;
            align-items: flex-end; 
        }

        .modal-content {
            background: white;
            width: 100%;
            max-height: 80vh;
            border-radius: 30px 30px 0 0;
            padding: 20px;
            overflow-y: auto;
        }

        .cute-input {
            border: 2px solid var(--aqua-soft);
            border-radius: 12px;
            padding: 10px 14px;
            width: 100%;
            font-size: 14px;
            -webkit-appearance: none;
        }

        .btn-option {
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid #EEE;
            font-size: 12px;
            background: white;
            color: #888;
            font-weight: bold;
        }

        .btn-option.selected {
            background: var(--aqua-main);
            color: white;
            border-color: var(--aqua-main);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div class="bg-container" id="bg-hearts"></div>

<div class="flex-1 flex flex-col p-4 relative z-10 max-w-md mx-auto w-full h-screen">
    <!-- é é¦–å€åŸŸï¼šç·Šæ¹Šæ’ç‰ˆ -->
    <header class="mb-2">
        <h1 class="cute-title text-2xl font-black text-center mb-1 tracking-tight">2026æ‰‹æ–å¤§ä½œæˆ°</h1>
        
        <!-- æ ¸å¿ƒçµ±è¨ˆè³‡è¨Š -->
        <div class="grid grid-cols-2 gap-2 mb-2">
            <div class="bg-white/90 rounded-xl p-2 flex items-center space-x-2 border border-white shadow-sm overflow-hidden">
                <span class="text-lg">ğŸ†</span>
                <div class="min-w-0">
                    <p class="text-[7px] font-bold text-gray-400 leading-none">æœ€æ„›åº—å®¶</p>
                    <p id="top-store" class="text-[11px] font-black text-[#78C2C4] truncate">å°šæœªç´€éŒ„</p>
                </div>
            </div>
            <div class="bg-white/90 rounded-xl p-2 flex items-center space-x-2 border border-white shadow-sm overflow-hidden">
                <span class="text-lg">ğŸ¥¤</span>
                <div class="min-w-0">
                    <p class="text-[7px] font-bold text-gray-400 leading-none">æœ€å¸¸é»</p>
                    <p id="top-item" class="text-[11px] font-black text-[#FFB380] truncate">å°šæœªç´€éŒ„</p>
                </div>
            </div>
        </div>

        <!-- æ•¸æ“šæ–¹å¡Š -->
        <div class="grid grid-cols-4 gap-1">
            <div class="stat-item"><p class="text-[7px] text-gray-400">å¹´åº¦æ¯</p><p id="stat-year-cups" class="text-xs font-black text-[#78C2C4]">0</p></div>
            <div class="stat-item"><p class="text-[7px] text-gray-400">å¹´åº¦$</p><p id="stat-year-cost" class="text-xs font-black text-[#FFB380]">0</p></div>
            <div class="stat-item"><p class="text-[7px] text-gray-400">æœˆæ¯æ•¸</p><p id="stat-month-cups" class="text-xs font-black text-[#78C2C4]">0</p></div>
            <div class="stat-item"><p class="text-[7px] text-gray-400">æœˆç¸½é¡</p><p id="stat-month-cost" class="text-xs font-black text-[#FFB380]">0</p></div>
        </div>
    </header>

    <!-- æœˆä»½æ§åˆ¶åˆ— -->
    <div class="flex justify-between items-center mb-2 px-1">
        <button onclick="changeMonth(-1)" class="w-8 h-8 bg-white/80 rounded-full shadow flex items-center justify-center">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--aqua-main)" stroke-width="4"><polyline points="15 18 9 12 15 6"></polyline></svg>
        </button>
        <h2 id="calendar-title" class="text-sm font-black text-white drop-shadow tracking-widest uppercase">JANUARY 2026</h2>
        <button onclick="changeMonth(1)" class="w-8 h-8 bg-white/80 rounded-full shadow flex items-center justify-center">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="var(--aqua-main)" stroke-width="4"><polyline points="9 18 15 12 9 6"></polyline></svg>
        </button>
    </div>

    <!-- æ—¥æ›†å®¹å™¨ï¼šè‡ªå‹•å¡«æ»¿å‰©é¤˜é«˜åº¦ -->
    <div class="glass-card p-2 flex-1 flex flex-col min-h-0">
        <div class="grid grid-cols-7 text-center mb-1 text-[8px] font-black text-gray-400 tracking-tighter">
            <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
        </div>
        <div id="calendar-grid" class="grid grid-cols-7 gap-1 flex-1 content-start"></div>
    </div>
    
    <p class="text-[8px] text-center text-white/60 py-1 italic">Â© 2026 Daily Drink Diary v2.0</p>
</div>

<!-- åº•éƒ¨å½ˆå‡ºå¼ç·¨è¼¯çª— -->
<div id="modal" class="modal-overlay">
    <div class="modal-content shadow-2xl flex flex-col">
        <div class="flex justify-between items-center mb-4">
            <h3 id="modal-date-display" class="text-xl font-black text-[#78C2C4]">2026 / 01 / 01</h3>
            <button onclick="closeModal()" class="text-gray-300 text-3xl font-black">âœ•</button>
        </div>

        <div id="forms-box" class="overflow-y-auto no-scrollbar flex-1 space-y-4 pb-4">
            <!-- å‹•æ…‹ç”Ÿæˆè¡¨å–® -->
        </div>

        <button onclick="saveData()" class="w-full bg-gradient-to-r from-[#78C2C4] to-[#FFB380] text-white py-4 rounded-2xl font-black text-lg shadow-lg active:scale-95 transition-all">
            ç¢ºèªå„²å­˜ â™¡
        </button>
    </div>
</div>

<script>
    let year = 2026;
    let month = 0;
    let drinkData = JSON.parse(localStorage.getItem('drink_full_screen_v1')) || {};
    let currentActiveDate = "";

    const iceOpts = ["æ­£å¸¸", "å°‘å†°", "å¾®å†°", "å»å†°", "å¸¸æº«"];
    const sugarOpts = ["å…¨ç³–", "åŠç³–", "å¾®ç³–", "ç„¡ç³–"];
    const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];

    function init() {
        createHearts();
        renderCalendar();
    }

    function createHearts() {
        const container = document.getElementById('bg-hearts');
        setInterval(() => {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = 'â¤';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.fontSize = (Math.random() * 15 + 10) + 'px';
            heart.style.color = Math.random() > 0.5 ? 'var(--aqua-main)' : 'var(--orange-main)';
            container.appendChild(heart);
            setTimeout(() => heart.remove(), 10000);
        }, 2500);
    }

    function renderCalendar() {
        const grid = document.getElementById('calendar-grid');
        const firstDay = new Date(year, month, 1).getDay();
        const totalDays = new Date(year, month + 1, 0).getDate();
        
        document.getElementById('calendar-title').innerText = `${monthNames[month]} ${year}`;

        grid.innerHTML = '';
        for(let i=0; i<firstDay; i++) grid.innerHTML += '<div></div>';

        for(let d=1; d<=totalDays; d++) {
            const dStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const hasData = drinkData[dStr] && drinkData[dStr].some(r => r.item);
            
            const cell = document.createElement('div');
            cell.className = `calendar-day ${hasData ? 'active' : ''}`;
            cell.innerHTML = `
                <span class="text-sm font-black ${hasData ? 'text-[#FFB380]' : 'text-gray-400'}">${d}</span>
                ${hasData ? '<span class="text-[7px] absolute bottom-0.5 animate-pulse">â¤</span>' : ''}
            `;
            cell.onclick = () => openModal(dStr);
            grid.appendChild(cell);
        }
        updateStats();
    }

    function openModal(dateStr) {
        currentActiveDate = dateStr;
        document.getElementById('modal-date-display').innerText = dateStr.replace(/-/g, ' / ');
        const box = document.getElementById('forms-box');
        box.innerHTML = '';

        const entries = drinkData[dateStr] || [{store:'', item:'', price:'', ice:'', sugar:''}];

        entries.forEach((entry, idx) => {
            const div = document.createElement('div');
            div.className = "p-4 rounded-2xl bg-gray-50 border border-gray-100 relative";
            div.innerHTML = `
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <input type="text" placeholder="åº—å®¶" class="cute-input" value="${entry.store}" onchange="updateEntry(${idx}, 'store', this.value)">
                    <input type="text" placeholder="é£²æ–™å“é …" class="cute-input" value="${entry.item}" onchange="updateEntry(${idx}, 'item', this.value)">
                </div>
                <input type="number" placeholder="é‡‘é¡ $" class="cute-input mb-3" value="${entry.price}" onchange="updateEntry(${idx}, 'price', this.value)">
                
                <div class="flex flex-wrap gap-1.5 mb-2">
                    ${iceOpts.map(o => `<button class="btn-option ${entry.ice===o?'selected':''}" onclick="setOpt(${idx},'ice','${o}',this)">${o}</button>`).join('')}
                </div>
                <div class="flex flex-wrap gap-1.5">
                    ${sugarOpts.map(o => `<button class="btn-option ${entry.sugar===o?'selected':''}" onclick="setOpt(${idx},'sugar','${o}',this)">${o}</button>`).join('')}
                </div>
            `;
            box.appendChild(div);
        });
        
        if(entries.length < 3) {
            const addBtn = document.createElement('button');
            addBtn.className = "w-full py-2 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-xs font-bold";
            addBtn.innerText = "+ ç´€éŒ„ä»Šå¤©å¦ä¸€æ¯æ‰‹æ–";
            addBtn.onclick = () => {
                if(!drinkData[currentActiveDate]) drinkData[currentActiveDate] = [];
                drinkData[currentActiveDate].push({store:'', item:'', price:'', ice:'', sugar:''});
                openModal(currentActiveDate);
            };
            box.appendChild(addBtn);
        }

        document.getElementById('modal').style.display = 'flex';
    }

    function updateEntry(idx, field, val) {
        if(!drinkData[currentActiveDate]) drinkData[currentActiveDate] = [{store:'', item:'', price:'', ice:'', sugar:''}];
        drinkData[currentActiveDate][idx][field] = val;
    }

    function setOpt(idx, field, val, btn) {
        updateEntry(idx, field, val);
        btn.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
    }

    function saveData() {
        if(drinkData[currentActiveDate]) {
            const valid = drinkData[currentActiveDate].filter(d => d.item || d.store);
            if(valid.length === 0) delete drinkData[currentActiveDate];
            else drinkData[currentActiveDate] = valid;
        }
        localStorage.setItem('drink_full_screen_v1', JSON.stringify(drinkData));
        closeModal();
        renderCalendar();
    }

    function updateStats() {
        let totalC=0, totalP=0, monthC=0, monthP=0;
        let storeMap = {}, itemMap = {};
        const monthPre = `${year}-${String(month+1).padStart(2,'0')}`;

        Object.keys(drinkData).forEach(d => {
            drinkData[d].forEach(r => {
                if(r.item) {
                    totalC++; 
                    totalP += Number(r.price || 0);
                    if(r.store) storeMap[r.store] = (storeMap[r.store] || 0) + 1;
                    if(r.item) itemMap[r.item] = (itemMap[r.item] || 0) + 1;
                    if(d.startsWith(monthPre)) {
                        monthC++;
                        monthP += Number(r.price || 0);
                    }
                }
            });
        });

        document.getElementById('top-store').innerText = Object.entries(storeMap).sort((a,b)=>b[1]-a[1])[0]?.[0] || "å°šæœªç´€éŒ„";
        document.getElementById('top-item').innerText = Object.entries(itemMap).sort((a,b)=>b[1]-a[1])[0]?.[0] || "å°šæœªç´€éŒ„";
        document.getElementById('stat-year-cups').innerText = totalC;
        document.getElementById('stat-year-cost').innerText = totalP;
        document.getElementById('stat-month-cups').innerText = monthC;
        document.getElementById('stat-month-cost').innerText = monthP;
    }

    function changeMonth(v) {
        month += v;
        if(month > 11) { month = 0; year++; }
        else if(month < 0) { month = 11; year--; }
        renderCalendar();
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    init();
</script>
</body>
</html>